name: Integracao continua e Inplantacao

on:
    push:
        branches:
            - main


permissions: 
          pull-requests: read # allows SonarCloud to decorate PRs with analysis results

env:
    DOTNET_VERSION: '8.0.x'
    AZURE_SECRET: ${{ secrets.AZURE_WEBAPP_PUBLISH_SECRET }} # variavel de ambiente que contem o secret do Azure
    AZURE_WEBAPP_NAME: 'cleanarchdemo' # nome do WebApp no Azure

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout para a master ‚≠ê
              uses: actions/checkout@v4.1.1
              with:
                   fetch-depth: 0

            - name: Configurando .NET Core SDK üîß
              uses: actions/setup-dotnet@v4.0.0
              with:
                  dotnet-version: ${{ env.DOTNET_VERSION }}

            - name: Restaurando dependencias ‚è≥      
              run: dotnet restore
                
            - name: Build da aplicacao üöÄ
              run: dotnet build -c Release --no-restore      
              
            - name: Executando os Testes üß™
              run: dotnet test -c Release --no-build

            - name: SonarCloud Scan üîç
              uses: SonarSource/sonarcloud-github-action@de2e56b42aa84d0b1c5b622644ac17e505c9a049
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                  SONAR_TOKEN: ${{ secrets.SONAR_TOKEN  }}
                  sonar.organization: CesaragsUC_clean-arch-testes-unitario-ci-cd
                  sonar.projectKey: cesaragsuc
                  sonar.projectName: clean-arch-testes-unitario-ci-cd
                  sonar.host.url: https://sonarcloud.io


            # abaixo temos as configuracoes necess√°ria para fazermos a publica√ß√£o da aplica√ß√£o e o deploy no Azure WebApp  

            # - name: Fazendo a publica√ß√£o da aplica√ß√£o üì¢
            #   run: dotnet publish -c Release -o ./publish # pasta onde a aplica√ß√£o ser√° publicada

            # - name: Fazendo deploy no Azure WebApp ‚òÅÔ∏è
            #   uses: Azure/webapps-deploy@v3.0.1
            #   with:
            #        app-name: ${{ env.AZURE_WEBAPP_NAME }}
            #        publish-profile: ${{ env.AZURE_SECRET }}
            #        package: ./publish # pasta onde a aplicacao foi publicada
            


            
